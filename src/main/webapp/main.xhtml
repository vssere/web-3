<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è —Ç–æ—á–∫–∏</title>
    <meta charset="UTF-8" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #6A0DAD 0%, #9370DB 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1300px;
            margin: 0 auto;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 3px solid #6A0DAD;
            padding-bottom: 15px;
        }
        .header h1 {
            color: #6A0DAD;
            margin: 0 0 10px 0;
        }
        .student-info {
            background: #6A0DAD;
            color: white;
            padding: 12px;
            border-radius: 8px;
            display: inline-block;
            margin: 10px 0;
        }
        .nav-back {
            display: inline-block;
            margin-left: 20px;
            color: #6A0DAD;
            text-decoration: none;
            font-weight: bold;
        }
        .nav-back:hover {
            text-decoration: underline;
        }
        .content-wrapper {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 25px;
            margin-top: 20px;
        }
        @media (max-width: 1000px) {
            .content-wrapper {
                grid-template-columns: 1fr;
            }
        }
        .form-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        .form-section h2 {
            color: #6A0DAD;
            margin-top: 0;
            border-bottom: 2px solid #6A0DAD;
            padding-bottom: 10px;
        }
        .form-group {
            margin-bottom: 18px;
        }
        .form-label {
            display: block;
            color: #333;
            font-weight: bold;
            margin-bottom: 6px;
        }
        .ui-selectonemenu, .ui-inputfield {
            width: 100% !important;
            padding: 8px !important;
            border: 2px solid #ddd !important;
            border-radius: 6px !important;
        }
        .ui-selectoneradio label {
            display: inline-block !important;
            padding: 8px 12px !important;
            margin: 4px !important;
            background: #e0e0e0 !important;
            border-radius: 6px !important;
            cursor: pointer !important;
        }
        .ui-selectoneradio .ui-state-active label {
            background: #6A0DAD !important;
            color: white !important;
        }
        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        .ui-button {
            flex: 1;
            padding: 10px !important;
            font-weight: bold !important;
            border-radius: 8px !important;
            border: none !important;
            cursor: pointer !important;
        }
        .ui-button-primary {
            background: #6A0DAD !important;
            color: white !important;
        }
        .ui-button-danger {
            background: #f44336 !important;
            color: white !important;
        }
        .graph-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            margin-bottom: 25px;
            text-align: center;
        }
        .graph-section h2 {
            color: #6A0DAD;
            margin-top: 0;
        }
        #graphCanvas {
            border: 3px solid #6A0DAD;
            border-radius: 8px;
            background: white;
            cursor: crosshair;
        }
        .table-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        .table-section h2 {
            color: #6A0DAD;
            margin-top: 0;
        }
        .ui-datatable {
            border: 2px solid #ddd !important;
            border-radius: 8px !important;
        }
        .ui-datatable thead th {
            background: #6A0DAD !important;
            color: white !important;
            text-align: center !important;
        }
        .hit {
            color: #4CAF50 !important;
            font-weight: bold !important;
        }
        .miss {
            color: #f44336 !important;
            font-weight: bold !important;
        }
        .graph-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #6A0DAD;
            color: white;
            padding: 15px;
            border-radius: 8px;
            z-index: 10000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
            max-width: 300px;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        .instructions {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }
        .instructions h3 {
            color: #1565c0;
            margin-top: 0;
        }
    </style>
</h:head>

<h:body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <h1>üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è —Ç–æ—á–∫–∏ –≤ –æ–±–ª–∞—Å—Ç—å</h1>
            <div class="student-info">
                <strong>–°–µ—Ä–µ–¥–∞ –í–µ—Ä–æ–Ω–∏–∫–∞ –°–µ—Ä–≥–µ–µ–≤–Ω–∞</strong> |
                –ì—Ä—É–ø–ø–∞: P3212 | –í–∞—Ä–∏–∞–Ω—Ç: 470354 | –ò–°–£: 467432
            </div>
            <h:link outcome="index.xhtml" value="‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É" styleClass="nav-back" />
        </div>

        <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
        <div class="instructions">
            <h3>üìã –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:</h3>
            <p>1. –í—ã–±–µ—Ä–∏—Ç–µ X –∏–∑ —Å–ø–∏—Å–∫–∞ (-2.0, -1.5, ..., 1.5)</p>
            <p>2. –í–≤–µ–¥–∏—Ç–µ Y (—Ü–µ–ª–æ–µ —á–∏—Å–ª–æ –æ—Ç -3 –¥–æ 3)</p>
            <p>3. –í—ã–±–µ—Ä–∏—Ç–µ R (–æ—Ç 1 –¥–æ 5)</p>
            <p>4. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å" –ò–õ–ò –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ</p>
        </div>

        <div class="content-wrapper">
            <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –§–æ—Ä–º–∞ -->
            <div class="form-section">
                <h2>üìù –í–≤–æ–¥ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</h2>

                <h:form id="pointForm">
                    <!-- X –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ -->
                    <div class="form-group">
                        <h:outputLabel for="x" value="–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ X:" styleClass="form-label" />
                        <p:selectOneMenu id="x" value="#{attempt.x}" required="true"
                                         requiredMessage="–í—ã–±–µ—Ä–∏—Ç–µ X">
                            <f:selectItem itemLabel="–í—ã–±–µ—Ä–∏—Ç–µ X" itemValue="" />
                            <f:selectItem itemValue="-2.0" itemLabel="-2.0" />
                            <f:selectItem itemValue="-1.5" itemLabel="-1.5" />
                            <f:selectItem itemValue="-1.0" itemLabel="-1.0" />
                            <f:selectItem itemValue="-0.5" itemLabel="-0.5" />
                            <f:selectItem itemValue="0.0" itemLabel="0.0" />
                            <f:selectItem itemValue="0.5" itemLabel="0.5" />
                            <f:selectItem itemValue="1.0" itemLabel="1.0" />
                            <f:selectItem itemValue="1.5" itemLabel="1.5" />
                        </p:selectOneMenu>
                        <p:message for="x" style="color: #f44336; font-size: 0.9em;" />
                    </div>

                    <!-- Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ -->
                    <div class="form-group">
                        <h:outputLabel for="y" value="–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y (-3 –¥–æ 3):" styleClass="form-label" />
                        <p:inputText id="y" value="#{attempt.y}" required="true"
                                     requiredMessage="–í–≤–µ–¥–∏—Ç–µ Y">
                            <f:validateLongRange minimum="-3" maximum="3" />
                        </p:inputText>
                        <p:message for="y" style="color: #f44336; font-size: 0.9em;" />
                    </div>

                    <!-- R —Ä–∞–¥–∏—É—Å -->
                    <div class="form-group">
                        <h:outputLabel for="r" value="–†–∞–¥–∏—É—Å R:" styleClass="form-label" />
                        <p:selectOneRadio id="r" value="#{attempt.r}" required="true"
                                          requiredMessage="–í—ã–±–µ—Ä–∏—Ç–µ R">
                            <f:selectItem itemValue="1" itemLabel="1" />
                            <f:selectItem itemValue="2" itemLabel="2" />
                            <f:selectItem itemValue="3" itemLabel="3" />
                            <f:selectItem itemValue="4" itemLabel="4" />
                            <f:selectItem itemValue="5" itemLabel="5" />
                        </p:selectOneRadio>
                        <p:message for="r" style="color: #f44336; font-size: 0.9em;" />
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∏ -->
                    <div class="button-group">
                        <p:commandButton value="‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å"
                                         action="#{attemptRepository.addAttemptFromBean()}"
                                         update="resultsTable messages"
                                         styleClass="ui-button ui-button-primary" />

                        <p:commandButton value="üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å"
                                         action="#{attemptRepository.clearAttempts()}"
                                         update="resultsTable"
                                         styleClass="ui-button ui-button-danger"
                                         onclick="return confirm('–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é?')" />
                    </div>

                    <!-- –°–∫—Ä—ã—Ç–∞—è —Ñ–æ—Ä–º–∞ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ -->
                    <h:form id="graphForm" style="display: none;">
                        <h:inputHidden id="graphX" value="#{attemptRepository.graphX}" />
                        <h:inputHidden id="graphY" value="#{attemptRepository.graphY}" />
                        <h:inputHidden id="graphR" value="#{attemptRepository.graphR}" />
                        <p:commandButton id="graphSubmitBtn"
                                         action="#{attemptRepository.addAttemptFromGraph()}"
                                         update="resultsTable"
                                         style="display: none;" />
                    </h:form>

                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
                    <p:messages id="messages" showDetail="true" />
                </h:form>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: –ì—Ä–∞—Ñ–∏–∫ –∏ —Ç–∞–±–ª–∏—Ü–∞ -->
            <div>
                <!-- –ì—Ä–∞—Ñ–∏–∫ -->
                <div class="graph-section">
                    <h2>üìà –ì—Ä–∞—Ñ–∏–∫ –æ–±–ª–∞—Å—Ç–∏ (R = <span id="currentRValue">#{empty attempt.r ? '2' : attempt.r}</span>)</h2>
                    <canvas id="graphCanvas" width="450" height="450"></canvas>
                    <p style="color: #666; margin-top: 10px;">üí° –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É</p>
                </div>

                <!-- –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
                <div class="table-section">
                    <h2>üìä –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫</h2>
                    <p:dataTable id="resultsTable"
                                 value="#{attemptRepository.latestAttemptsList}"
                                 var="attemptItem"
                                 emptyMessage="–ü–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —Ç–æ—á–∫—É!"
                                 rows="8"
                                 paginator="true">

                        <p:column headerText="X">
                            <h:outputText value="#{attemptItem.x}" />
                        </p:column>

                        <p:column headerText="Y">
                            <h:outputText value="#{attemptItem.y}" />
                        </p:column>

                        <p:column headerText="R">
                            <h:outputText value="#{attemptItem.r}" />
                        </p:column>

                        <p:column headerText="–†–µ–∑—É–ª—å—Ç–∞—Ç">
                            <h:outputText value="#{attemptItem.result ? 'üéØ –ü–æ–ø–∞–¥–∞–Ω–∏–µ' : '‚ùå –ü—Ä–æ–º–∞—Ö'}"
                                          styleClass="#{attemptItem.result ? 'hit' : 'miss'}" />
                        </p:column>

                        <p:column headerText="–í—Ä–µ–º—è">
                            <h:outputText value="#{attemptItem.createdAt}">
                                <f:convertDateTime pattern="dd.MM.yyyy HH:mm:ss" />
                            </h:outputText>
                        </p:column>

                    </p:dataTable>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–ª–Ω—ã–π —Ä–∞–±–æ—á–∏–π –≥—Ä–∞—Ñ–∏–∫ -->
    <script>
        console.log('=== –ì–†–ê–§–ò–ö –ó–ê–ì–†–£–ñ–ê–ï–¢–°–Ø ===');

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentR = 2;
        let canvas, ctx;

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ R –∏–∑ —Ñ–æ—Ä–º—ã
        function getCurrentRFromForm() {
            const rDisplay = document.getElementById('currentRValue');
            if (rDisplay) {
                return parseFloat(rDisplay.textContent) || 2;
            }

            // –ò—â–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π radio
            const checkedRadio = document.querySelector('input[name*=":r"]:checked');
            if (checkedRadio) {
                return parseFloat(checkedRadio.value);
            }

            return 2;
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –æ–±–ª–∞—Å—Ç–∏
        function drawArea(r) {
            if (!canvas || !ctx) return;

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = 40; // –ø–∏–∫—Å–µ–ª–µ–π –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É

            // 1. –ß–µ—Ç–≤–µ—Ä—Ç—å –∫—Ä—É–≥–∞ (–ª–µ–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π –∫–≤–∞–¥—Ä–∞–Ω—Ç)
            ctx.fillStyle = 'rgba(106, 13, 173, 0.3)'; // –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π
            ctx.strokeStyle = '#6A0DAD';
            ctx.lineWidth = 2;

            ctx.beginPath();
            ctx.arc(centerX, centerY, (r/2) * scale, Math.PI, Math.PI * 1.5, false);
            ctx.lineTo(centerX, centerY);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            // 2. –¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ (–ø—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π –∫–≤–∞–¥—Ä–∞–Ω—Ç)
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX + (r/2) * scale, centerY);
            ctx.lineTo(centerX, centerY - r * scale);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            // 3. –ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ (–ª–µ–≤—ã–π –Ω–∏–∂–Ω–∏–π –∫–≤–∞–¥—Ä–∞–Ω—Ç)
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX - r * scale, centerY);
            ctx.lineTo(centerX - r * scale, centerY + (r/2) * scale);
            ctx.lineTo(centerX, centerY + (r/2) * scale);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è —Å–µ—Ç–∫–∏ –∏ –æ—Å–µ–π
        function drawGridAndAxes() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = 40;

            // –°–µ—Ç–∫–∞ (—Å–≤–µ—Ç–ª–æ-—Å–µ—Ä–∞—è)
            ctx.strokeStyle = '#f0f0f0';
            ctx.lineWidth = 1;

            // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            for (let i = -5; i &amp;lt;= 5; i++) {
                const x = centerX + i * scale;
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }

            // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            for (let i = -5; i &amp;lt;= 5; i++) {
                const y = centerY - i * scale;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }

            // –û—Å–∏ (—á–µ—Ä–Ω—ã–µ)
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;

            // –û—Å—å X
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(canvas.width, centerY);
            ctx.stroke();

            // –û—Å—å Y
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, canvas.height);
            ctx.stroke();

            // –ü–æ–¥–ø–∏—Å–∏ –æ—Å–µ–π
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.fillText('X', canvas.width - 10, centerY - 10);
            ctx.fillText('Y', centerX + 10, 20);
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
        function drawGraph() {
            if (!canvas || !ctx) {
                console.error('Canvas –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                return;
            }

            // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–π R
            currentR = getCurrentRFromForm();
            console.log('–†–∏—Å—É–µ–º –≥—Ä–∞—Ñ–∏–∫ –¥–ª—è R =', currentR);

            // –û—á–∏—â–∞–µ–º canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É –∏ –æ—Å–∏
            drawGridAndAxes();

            // –†–∏—Å—É–µ–º –æ–±–ª–∞—Å—Ç—å
            drawArea(currentR);

            // –ü–æ–¥–ø–∏—Å—å
            ctx.fillStyle = '#6A0DAD';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('–ì—Ä–∞—Ñ–∏–∫ –¥–ª—è R = ' + currentR, canvas.width / 2, 30);
        }

        // –§—É–Ω–∫—Ü–∏—è –∫–ª–∏–∫–∞ –ø–æ –≥—Ä–∞—Ñ–∏–∫—É
        function handleCanvasClick(event) {
            const rect = canvas.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const clickY = event.clientY - rect.top;

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = 40;

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã canvas ‚Üí –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ
            const mathX = (clickX - centerX) / scale;
            const mathY = (centerY - clickY) / scale;

            console.log('–ö–ª–∏–∫ –ø–æ –≥—Ä–∞—Ñ–∏–∫—É:', mathX.toFixed(2), mathY.toFixed(2));

            // –û–∫—Ä—É–≥–ª—è–µ–º X –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
            const validX = [-2.0, -1.5, -1.0, -0.5, 0.0, 0.5, 1.0, 1.5];
            let closestX = validX[0];
            let minDiff = Math.abs(mathX - closestX);

            for (let i = 0; i &amp;lt; validX.length; i++) {
                const val = validX[i];
                const diff = Math.abs(mathX - val);
                if (diff &amp;lt; minDiff) {
                    minDiff = diff;
                    closestX = val;
                }
            }

            // –û–∫—Ä—É–≥–ª—è–µ–º Y –∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º [-3, 3]
            const roundedY = Math.round(mathY);
            const clampedY = Math.max(-3, Math.min(3, roundedY));

            console.log('–û–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:', closestX, clampedY);

            // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã
            const xSelect = document.querySelector('select[id*=":x"]');
            const yInput = document.querySelector('input[id*=":y"]');

            if (xSelect &amp;&amp; yInput) {
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
                xSelect.value = closestX;
                yInput.value = clampedY;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                showNotification('üéØ –¢–æ—á–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞: X=' + closestX + ', Y=' + clampedY + ', R=' + currentR);

                // –ò–º–∏—Ç–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
                const inputEvent = new Event('input', { bubbles: true });
                const changeEvent = new Event('change', { bubbles: true });
                yInput.dispatchEvent(inputEvent);
                xSelect.dispatchEvent(changeEvent);

                // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –∏ –Ω–∞–∂–∏–º–∞–µ–º –∫–Ω–æ–ø–∫—É
                setTimeout(function() {
                    const submitBtn = document.querySelector('button.ui-button-primary');
                    if (submitBtn) {
                        console.log('–ù–∞–∂–∏–º–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å"');
                        submitBtn.click();
                    }
                }, 300);
            } else {
                console.error('–ù–µ –Ω–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(message) {
            // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #6A0DAD;
                color: white;
                padding: 15px;
                border-radius: 8px;
                z-index: 10000;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease;
                max-width: 300px;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(function() {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(function() {
                    notification.remove();
                }, 300);
            }, 3000);
        }

        // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
        function addNotificationStyles() {
            if (!document.querySelector('#graph-styles')) {
                const style = document.createElement('style');
                style.id = 'graph-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function initGraph() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞...');

            canvas = document.getElementById('graphCanvas');
            if (!canvas) {
                console.error('Canvas –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                return;
            }

            ctx = canvas.getContext('2d');
            if (!ctx) {
                console.error('–ö–æ–Ω—Ç–µ–∫—Å—Ç canvas –Ω–µ –ø–æ–ª—É—á–µ–Ω!');
                return;
            }

            console.log('Canvas –Ω–∞–π–¥–µ–Ω, —Ä–∞–∑–º–µ—Ä—ã:', canvas.width, 'x', canvas.height);

            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            addNotificationStyles();

            // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
            drawGraph();

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
            canvas.addEventListener('click', handleCanvasClick);

            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–¥–∏—É—Å–∞ R
            document.querySelectorAll('input[name*=":r"]').forEach(function(radio) {
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        console.log('–†–∞–¥–∏—É—Å –∏–∑–º–µ–Ω–µ–Ω –Ω–∞:', this.value);
                        drawGraph();
                    }
                });
            });

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –ø–æ—Å–ª–µ AJAX (PrimeFaces)
            if (window.PrimeFaces) {
                PrimeFaces.ajax.AjaxUtils.registerCallback('complete', function() {
                    console.log('AJAX –∑–∞–≤–µ—Ä—à–µ–Ω, –æ–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫...');
                    setTimeout(drawGraph, 100);
                });
            }

            console.log('‚úÖ –ì—Ä–∞—Ñ–∏–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', function() {
            console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ–º –≥—Ä–∞—Ñ–∏–∫...');
            setTimeout(initGraph, 100);
        });

        console.log('=== –°–ö–†–ò–ü–¢ –ó–ê–ì–†–£–ñ–ï–ù ===');
    </script>

    </h:body>
</html>