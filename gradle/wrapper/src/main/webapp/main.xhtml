<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<h:head>
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è —Ç–æ—á–∫–∏</title>
    <meta charset="UTF-8" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #6A0DAD 0%, #9370DB 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #6A0DAD;
            padding-bottom: 20px;
        }
        .header h1 {
            color: #6A0AD;
            margin: 0 0 10px 0;
        }
        .student-info {
            background: #6A0DAD;
            color: white;
            padding: 15px;
            border-radius: 10px;
            display: inline-block;
            margin: 10px 0;
        }
        .nav-back {
            display: inline-block;
            margin-left: 20px;
            color: #6A0DAD;
            text-decoration: none;
            font-weight: bold;
        }
        .nav-back:hover {
            text-decoration: underline;
        }
        .content-wrapper {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }
        .form-section {
            flex: 1;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        .graph-section {
            flex: 2;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            text-align: center;
        }
        .form-section h2, .graph-section h2 {
            color: #6A0DAD;
            margin-top: 0;
            border-bottom: 2px solid #6A0DAD;
            padding-bottom: 15px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            display: block;
            color: #333;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .form-control {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .form-control:focus {
            outline: none;
            border-color: #6A0DAD;
            box-shadow: 0 0 0 3px rgba(106, 13, 173, 0.1);
        }
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        .btn {
            flex: 1;
            padding: 12px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }
        .btn-primary {
            background: #6A0DAD;
            color: white;
        }
        .btn-primary:hover {
            background: #5a0c9d;
        }
        .btn-danger {
            background: #f44336;
            color: white;
        }
        .btn-danger:hover {
            background: #d32f2f;
        }
        #graphCanvas {
            border: 3px solid #6A0DAD;
            border-radius: 8px;
            background: white;
            cursor: crosshair;
        }
        .table-section {
            margin-top: 30px;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        .table-section h2 {
            color: #6A0DAD;
            margin-top: 0;
            border-bottom: 2px solid #6A0DAD;
            padding-bottom: 15px;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            border: 2px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        .data-table th {
            background: #6A0DAD;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }
        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
            text-align: center;
        }
        .data-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        .data-table tr:hover {
            background: #f0f0f0;
        }
        .hit {
            color: #4CAF50;
            font-weight: bold;
        }
        .miss {
            color: #f44336;
            font-weight: bold;
        }
        .error-message {
            color: #f44336;
            font-size: 14px;
            margin-top: 5px;
            display: block;
        }
    </style>
</h:head>

<h:body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <h1>üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è —Ç–æ—á–∫–∏ –≤ –æ–±–ª–∞—Å—Ç—å</h1>
            <div class="student-info">
                <strong>–°–µ—Ä–µ–¥–∞ –í–µ—Ä–æ–Ω–∏–∫–∞ –°–µ—Ä–≥–µ–µ–≤–Ω–∞</strong> |
                –ì—Ä—É–ø–ø–∞: P3212 | –í–∞—Ä–∏–∞–Ω—Ç: 470354 | –ò–°–£: 467432
            </div>
            <h:link outcome="index.xhtml" value="‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É" styleClass="nav-back" />
        </div>

        <div class="content-wrapper">
            <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –§–æ—Ä–º–∞ -->
            <div class="form-section">
                <h2>üìù –í–≤–æ–¥ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</h2>

                <h:form id="pointForm">
                    <!-- X –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ -->
                    <div class="form-group">
                        <h:outputLabel for="x" value="–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ X:" styleClass="form-label" />
                        <h:selectOneMenu id="x" value="#{attempt.x}" styleClass="form-control">
                            <f:selectItem itemLabel="–í—ã–±–µ—Ä–∏—Ç–µ X" itemValue="" />
                            <f:selectItem itemValue="-2.0" itemLabel="-2.0" />
                            <f:selectItem itemValue="-1.5" itemLabel="-1.5" />
                            <f:selectItem itemValue="-1.0" itemLabel="-1.0" />
                            <f:selectItem itemValue="-0.5" itemLabel="-0.5" />
                            <f:selectItem itemValue="0.0" itemLabel="0.0" />
                            <f:selectItem itemValue="0.5" itemLabel="0.5" />
                            <f:selectItem itemValue="1.0" itemLabel="1.0" />
                            <f:selectItem itemValue="1.5" itemLabel="1.5" />
                        </h:selectOneMenu>
                    </div>

                    <!-- Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ -->
                    <div class="form-group">
                        <h:outputLabel for="y" value="–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y (-3 –¥–æ 3):" styleClass="form-label" />
                        <h:inputText id="y" value="#{attempt.y}" styleClass="form-control" />
                    </div>

                    <!-- R —Ä–∞–¥–∏—É—Å -->
                    <div class="form-group">
                        <h:outputLabel for="r" value="–†–∞–¥–∏—É—Å R:" styleClass="form-label" />
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <h:selectOneRadio id="r" value="#{attempt.r}" layout="pageDirection">
                                <f:selectItem itemValue="1" itemLabel="1" />
                                <f:selectItem itemValue="2" itemLabel="2" />
                                <f:selectItem itemValue="3" itemLabel="3" />
                                <f:selectItem itemValue="4" itemLabel="4" />
                                <f:selectItem itemValue="5" itemLabel="5" />
                            </h:selectOneRadio>
                        </div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∏ -->
                    <div class="button-group">
                        <h:commandButton value="‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å"
                                         action="#{attemptRepository.addAttemptFromBean()}"
                                         styleClass="btn btn-primary" />

                        <h:commandButton value="üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å"
                                         action="#{attemptRepository.clearAttempts()}"
                                         styleClass="btn btn-danger"
                                         onclick="return confirm('–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ–≤–µ—Ä–æ–∫?')" />
                    </div>
                </h:form>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: –ì—Ä–∞—Ñ–∏–∫ -->
            <div class="graph-section">
                <h2>üìà –ì—Ä–∞—Ñ–∏–∫ –æ–±–ª–∞—Å—Ç–∏</h2>
                <canvas id="graphCanvas" width="500" height="500"></canvas>
                <p style="color: #666; margin-top: 15px;">üí° –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ—á–∫–∏</p>
            </div>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
        <div class="table-section">
            <h2>üìä –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫</h2>

            <h:dataTable value="#{attemptRepository.latestAttemptsList}"
                         var="attemptItem"
                         styleClass="data-table"
                         headerClass="table-header"
                         rowClasses="table-row-odd, table-row-even">

                <h:column>
                    <f:facet name="header">X</f:facet>
                    #{attemptItem.x}
                </h:column>

                <h:column>
                    <f:facet name="header">Y</f:facet>
                    #{attemptItem.y}
                </h:column>

                <h:column>
                    <f:facet name="header">R</f:facet>
                    #{attemptItem.r}
                </h:column>

                <h:column>
                    <f:facet name="header">–†–µ–∑—É–ª—å—Ç–∞—Ç</f:facet>
                    <span style="color: #{attemptItem.result ? '#4CAF50' : '#f44336'}; font-weight: bold;">
                        #{attemptItem.result ? 'üéØ –ü–æ–ø–∞–¥–∞–Ω–∏–µ' : '‚ùå –ü—Ä–æ–º–∞—Ö'}
                    </span>
                </h:column>

                <h:column>
                    <f:facet name="header">–í—Ä–µ–º—è</f:facet>
                    <h:outputText value="#{attemptItem.createdAt}">
                        <f:convertDateTime pattern="dd.MM.yyyy HH:mm:ss" />
                    </h:outputText>
                </h:column>

            </h:dataTable>

            <h:outputText value="–ü–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —Ç–æ—á–∫—É!"
                          rendered="#{empty attemptRepository.latestAttemptsList}"
                          style="display: block; text-align: center; padding: 30px; color: #666; font-size: 18px;" />
        </div>
    </div>

    <!-- –ü–†–û–°–¢–û–ô –∏ –†–ê–ë–û–ß–ò–ô JavaScript –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ -->
    <script><![CDATA[
        // –ñ–¥—ë–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== –ó–ê–ì–†–£–ó–ö–ê –ì–†–ê–§–ò–ö–ê ===');

            // –ù–∞—Ö–æ–¥–∏–º canvas
            var canvas = document.getElementById('graphCanvas');
            if (!canvas) {
                console.error('‚ùå Canvas –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                return;
            }

            console.log('‚úÖ Canvas –Ω–∞–π–¥–µ–Ω: ' + canvas.width + 'x' + canvas.height);

            var ctx = canvas.getContext('2d');
            if (!ctx) {
                console.error('‚ùå –ö–æ–Ω—Ç–µ–∫—Å—Ç canvas –Ω–µ –ø–æ–ª—É—á–µ–Ω!');
                return;
            }

            // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
            var centerX = canvas.width / 2;
            var centerY = canvas.height / 2;
            var scale = 40; // –ø–∏–∫—Å–µ–ª–µ–π –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É
            var currentR = 2; // –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

            // ===== –§–£–ù–ö–¶–ò–Ø –†–ò–°–û–í–ê–ù–ò–Ø –ì–†–ê–§–ò–ö–ê =====
            function drawGraph() {
                console.log('üé® –†–∏—Å—É–µ–º –≥—Ä–∞—Ñ–∏–∫...');

                // 1. –û—á–∏—â–∞–µ–º canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // 2. –ë–µ–ª—ã–π —Ñ–æ–Ω
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // 3. –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É (—Å–≤–µ—Ç–ª–æ-—Å–µ—Ä–∞—è)
                ctx.strokeStyle = '#f0f0f0';
                ctx.lineWidth = 1;

                // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
                for (var i = -5; i <= 5; i++) {
                    var x = centerX + i * scale;
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, canvas.height);
                    ctx.stroke();
                }

                // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
                for (var i = -5; i <= 5; i++) {
                    var y = centerY - i * scale;
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(canvas.width, y);
                    ctx.stroke();
                }

                // 4. –†–∏—Å—É–µ–º –æ—Å–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (—á—ë—Ä–Ω—ã–µ)
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;

                // –û—Å—å X
                ctx.beginPath();
                ctx.moveTo(0, centerY);
                ctx.lineTo(canvas.width, centerY);
                ctx.stroke();

                // –û—Å—å Y
                ctx.beginPath();
                ctx.moveTo(centerX, 0);
                ctx.lineTo(centerX, canvas.height);
                ctx.stroke();

                // 5. –†–∏—Å—É–µ–º –æ–±–ª–∞—Å—Ç—å –ø–æ–ø–∞–¥–∞–Ω–∏—è (—Å–∏—Ä–µ–Ω–µ–≤–∞—è)
                if (currentR > 0) {
                    ctx.fillStyle = 'rgba(147, 112, 219, 0.3)';
                    ctx.strokeStyle = '#6A0DAD';
                    ctx.lineWidth = 2;

                    // 5.1 –õ–µ–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ (-R/2 –¥–æ 0, 0 –¥–æ R)
                    ctx.beginPath();
                    ctx.rect(centerX, centerY - currentR * scale,
                            -(currentR/2) * scale, -currentR * scale);
                    ctx.fill();
                    ctx.stroke();

                    // 5.2 –ü—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —á–µ—Ç–≤–µ—Ä—Ç—å –∫—Ä—É–≥–∞ —Ä–∞–¥–∏—É—Å–æ–º R
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.arc(centerX, centerY, currentR * scale, 0, Math.PI / 2, false);
                    ctx.lineTo(centerX, centerY);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();

                    // 5.3 –õ–µ–≤—ã–π –Ω–∏–∂–Ω–∏–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.lineTo(centerX - currentR * scale, centerY);
                    ctx.lineTo(centerX, centerY + (currentR/2) * scale);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                }

                // 6. –ü–æ–¥–ø–∏—Å—å –≥—Ä–∞—Ñ–∏–∫–∞
                ctx.fillStyle = '#6A0DAD';
                ctx.font = 'bold 18px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('–ì—Ä–∞—Ñ–∏–∫ –æ–±–ª–∞—Å—Ç–∏ (R = ' + currentR + ')', centerX, 30);

                console.log('‚úÖ –ì—Ä–∞—Ñ–∏–∫ –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω');
            }

            // ===== –û–ë–†–ê–ë–û–¢–ö–ê –ö–õ–ò–ö–ê –ü–û –ì–†–ê–§–ò–ö–£ =====
            canvas.onclick = function(event) {
                // –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–ª–∏–∫–∞
                var rect = canvas.getBoundingClientRect();
                var clickX = event.clientX - rect.left;
                var clickY = event.clientY - rect.top;

                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                var mathX = ((clickX - centerX) / scale).toFixed(2);
                var mathY = ((centerY - clickY) / scale).toFixed(2);

                console.log('üéØ –ö–ª–∏–∫ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ: X=' + mathX + ', Y=' + mathY);

                // –†–∏—Å—É–µ–º —Ç–æ—á–∫—É –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ
                ctx.fillStyle = '#4CAF50'; // –∑–µ–ª—ë–Ω—ã–π —Ü–≤–µ—Ç
                ctx.beginPath();
                ctx.arc(clickX, clickY, 6, 0, Math.PI * 2);
                ctx.fill();

                // –û–±–≤–æ–¥–∏–º —Ç–æ—á–∫—É
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 1;
                ctx.stroke();

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                alert('‚úÖ –¢–æ—á–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!\n\n' +
                      '–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:\n' +
                      'X = ' + mathX + '\n' +
                      'Y = ' + mathY + '\n' +
                      'R = ' + currentR + '\n\n' +
                      '–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–∂–º–∏—Ç–µ "‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å" –≤ —Ñ–æ—Ä–º–µ');
            };

            // ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ì–†–ê–§–ò–ö–ê –ü–†–ò –ò–ó–ú–ï–ù–ï–ù–ò–ò R =====
            var radioButtons = document.querySelectorAll('input[name="pointForm:r"]');
            for (var i = 0; i < radioButtons.length; i++) {
                radioButtons[i].addEventListener('change', function() {
                    if (this.checked) {
                        currentR = parseFloat(this.value);
                        console.log('üîÑ –†–∞–¥–∏—É—Å –∏–∑–º–µ–Ω—ë–Ω: R = ' + currentR);
                        drawGraph();
                    }
                });
            }

            // ===== –ü–ï–†–í–û–ù–ê–ß–ê–õ–¨–ù–ê–Ø –û–¢–†–ò–°–û–í–ö–ê =====
            drawGraph();
            canvas.style.cursor = 'crosshair';

            console.log('‚úÖ –ì—Ä–∞—Ñ–∏–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!');
        });
    ]]></script>
</h:body>
</html>